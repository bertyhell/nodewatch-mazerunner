!function(e){var t={};function r(a){if(t[a])return t[a].exports;var n=t[a]={i:a,l:!1,exports:{}};return e[a].call(n.exports,n,n.exports,r),n.l=!0,n.exports}r.m=e,r.c=t,r.d=function(e,t,a){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(r.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)r.d(a,n,function(t){return e[t]}.bind(null,n));return a},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=2)}([function(e,t,r){"use strict";r.d(t,"h",(function(){return l})),r.d(t,"a",(function(){return i})),r.d(t,"b",(function(){return c})),r.d(t,"f",(function(){return f})),r.d(t,"g",(function(){return u})),r.d(t,"d",(function(){return y})),r.d(t,"e",(function(){return d})),r.d(t,"c",(function(){return s}));var a,n={},o=!1;function l(e){if(!o){var t=(new Date).getTime();if(a){var r=t-a;n[e]?(n[e].avgTime=(n[e].avgTime*n[e].traces+r)/(n[e].traces+1),n[e].traces+=1):n[e]={avgTime:r,traces:1}}a=t,n[e]&&10===n[e].traces&&(Object.keys(n).forEach((function(e){console.log(e+";"+n[e].avgTime)})),o=!0)}}function i(e){return(e+360)%360}function c(e){return Math.cos(e/180*Math.PI)}function f(e){return Math.sin(e/180*Math.PI)}function u(e){return Math.tan(e/180*Math.PI)}function y(e,t,r,a){return(r-e)*(r-e)+(a-t)*(a-t)}function d(e,t){return!(t.x>=0&&t.x<e[0].length&&t.y>=0&&t.y<e.length)}function h(e,t){return[{x:t.x-2,y:t.y},{x:t.x,y:t.y-2},{x:t.x+2,y:t.y},{x:t.x,y:t.y+2}].filter((function(t){return!d(e,t)&&-1===e[t.y][t.x]}))}function s(e,t){for(var r=new Array(t),a=0;a<t;a++){r[a]=new Array(e);for(var n=0;n<e;n++)r[a][n]=a%2==0||n%2==0?1:-1}var o,l,i,c=[],f={x:1,y:1};for(r[f.y][f.x]=0,c.push(f);c.length;)if((o=h(r,f=c.pop())).length){c.push(f);var u=o[(l=0,i=o.length-1,Math.floor(Math.random()*(i-l+1)+l))];r[(u.y+f.y)/2][(u.x+f.x)/2]=0,r[u.y][u.x]=0,c.push(u)}return r[1][1]=2,r[t-2][e-2]=3,r}},function(e,t,r){"use strict";r.d(t,"a",(function(){return p}));var a,n,o,l=r(0),i=1,c=Object(l.c)(21,13),f=1===c[1][2]?90:0,u={mazeWidth:10,mazeHeight:6,screenWidth:240,screenHeight:160,viewAngleWidth:70,angleStep:7,playerStepSize:.1,mazeHorCells:21,mazeVerCells:13,playerX:1.5,playerY:1.5,maze:c,playerAngle:f,startGame:function(e){},stopGame:function(){}},y=!0;function d(e,t,r){var a,n,o,i,f,y,d,h,s,p,g,b,v,x,j,O,m,w,M=Math.floor(e/90),T=0;for(Object(l.h)("01 collision start hor");!a||!n;)g=2===M||3===M,a||(o||(i=g?Math.floor(u.playerY):Math.floor(u.playerY)+1,o=u.playerX-(u.playerY-i)/Object(l.g)(e)),Object(l.h)("02 after hor intersect"),0===T||d||(h=g?-1:1,d=1/Object(l.g)(e)),Object(l.h)("03 after hor offset"),v=o+(d||0)*T*(g?-1:1),x=i+(h||0)*T,j={x:Math.floor(v),y:Math.floor(x)+(g?-1:0)},Object(l.h)("04 after hor grid location"),Object(l.e)(c,j)||1===c[j.y][j.x]?(t&&r.drawDebugPixel(v,x),a={x:v,y:x}):t&&r.drawDebugPixel(v,x,"#FF0000"),Object(l.h)("05 after hor found location")),Object(l.h)("06 collision start vert"),b=0===M||3===M,n||(f||(f=b?Math.floor(u.playerX)+1:Math.floor(u.playerX),y=u.playerY-(u.playerX-f)*Object(l.g)(e)),Object(l.h)("07 after vert intersect"),0===T||s||(s=b?1:-1,p=Math.abs(Object(l.g)(e))*(g?-1:1)),Object(l.h)("08 after vert offset"),O=f+(s||0)*T,m=y+(p||0)*T,w={x:Math.floor(O)+(b?0:-1),y:Math.floor(m)},Object(l.h)("09 after vert grid location"),Object(l.e)(c,w)||1===c[w.y][w.x]?(t&&r.drawDebugPixel(O,m),n={x:O,y:m}):t&&r.drawDebugPixel(O,m,"#FF0000"),Object(l.h)("10 after vert found location")),T++;Object(l.h)("11 after intersection found location");var S=Object(l.d)(u.playerX,u.playerY,a.x,a.y)<Object(l.d)(u.playerX,u.playerY,n.x,n.y)?a:n;if(t&&r.drawDebugPixel(S.x,S.y,"#00FF00"),r.drawDebugLine(u.playerX,u.playerY,S.x,S.y),!S)throw new Error("intersection is null");return Object(l.h)("12 return intersection"),S}function h(e,t){return 1===c[Math.floor(t)][Math.floor(e)]}function s(e,t){var r=u.playerX+e,a=u.playerY+t;return h(r,a)&&h(r=u.playerX,a=u.playerY+t)&&h(r=u.playerX+e,a=u.playerY)?void 0:(u.playerX=r,void(u.playerY=a))}u.startGame=function(e){y=!0,function e(t){t.BTN4.read()&&(console.log("left"),u.playerAngle=Object(l.a)(u.playerAngle-u.angleStep));t.BTN5.read()&&(console.log("right"),u.playerAngle=Object(l.a)(u.playerAngle+u.angleStep));var r,f,h,p,g;t.BTN1.read()&&(console.log("forward"),r=Math.floor(u.playerAngle/90),f=2===r||3===r,h=3===r||0===r,p=Math.abs(Object(l.b)(u.playerAngle)*u.playerStepSize)*(h?1:-1),g=Math.abs(Object(l.f)(u.playerAngle)*u.playerStepSize)*(f?-1:1),s(p,g));t.BTN2.read()&&(console.log("backward"),r=Math.floor(u.playerAngle/90),f=2===r||3===r,h=3===r||0===r,p=Math.abs(Object(l.b)(u.playerAngle)*u.playerStepSize)*(h?-1:1),g=Math.abs(Object(l.f)(u.playerAngle)*u.playerStepSize)*(f?1:-1),s(p,g));if(!y)return;a===u.playerX&&n===u.playerY&&o===u.playerAngle||(t.clear(),function(e){e.drawDebugGrid(c);for(var t=Object(l.a)(u.playerAngle-u.viewAngleWidth/2),r=u.viewAngleWidth/u.screenWidth,a=[],n=0;n<u.screenWidth;n+=i){var o=Object(l.a)(t+r*n),f=d(o,0===n||n>=u.screenWidth-1,e),y=Math.sqrt(Object(l.d)(u.playerX,u.playerY,f.x,f.y))*Object(l.b)(Object(l.a)(o-u.playerAngle));a.push({angle:o,collision:f,distance:y,shouldDrawWall:!1})}var h={};a.forEach((function(e){var t=Math.round(e.collision.x),r=Math.round(e.collision.y);h[t+";"+r]={x:t,y:r}}));var s={"0000":!1,"0001":!0,"0010":!0,"0011":!1,"0100":!0,"0101":!1,"0110":!1,"0111":!0,1e3:!0,1001:!0,1010:!1,1011:!0,1100:!1,1101:!0,1110:!0,1111:!1},p=[];Object.keys(h).forEach((function(e){var t=h[e],r=c[t.y-1][t.x-1],a=c[t.y-1][t.x],n=c[t.y][t.x-1],o=c[t.y][t.x];s[(1===r?"1":"0")+(1===a?"1":"0")+(1===n?"1":"0")+(1===o?"1":"0")]&&p.push(t)})),s={},p.forEach((function(e){var t=1e5,r=0;a.forEach((function(a,n){var o=Math.abs(e.x-a.collision.x)+Math.abs(e.y-a.collision.y);o<t&&(r=n,t=o)})),a[r].shouldDrawWall=!0})),a.forEach((function(t,r){var a=u.screenHeight/t.distance;t.shouldDrawWall?e.drawVerticalLine(r,Math.round((u.screenHeight-a)/2),Math.round((u.screenHeight-a)/2+a)):(e.drawPixel(r,Math.round((u.screenHeight-a)/2)),e.drawPixel(r,Math.round((u.screenHeight-a)/2+a)))}))}(t),t.flip());a=u.playerX,n=u.playerY,o=u.playerAngle,setTimeout((function(){return e(t)}),50)}(e)},u.stopGame=function(){y=!1};var p=u},function(e,t,r){"use strict";r.r(t);var a=r(1),n=r(0),o=40,l={BTN1:{name:"up",code:38,bangleVar:"BTN1",active:!1},BTN2:{name:"down",code:40,bangleVar:"BTN2",active:!1},BTN3:{name:"menu",code:9,bangleVar:"BTN3",active:!1},BTN4:{name:"left",code:37,bangleVar:"BTN4",active:!1},BTN5:{name:"right",code:39,bangleVar:"BTN5",active:!1}};[{prop:"keyup",active:!1},{prop:"keydown",active:!0}].forEach((function(e){document.addEventListener(e.prop,(function(t){Object.keys(l).forEach((function(r){(t.which||t.keyCode)===l[r].code&&(l[r].active=e.active)}))}))}));var i,c,f={BTN1:{read:function(){return l.BTN1.active}},BTN2:{read:function(){return l.BTN2.active}},BTN3:{read:function(){return l.BTN3.active}},BTN4:{read:function(){return l.BTN4.active}},BTN5:{read:function(){return l.BTN5.active}},drawPixel:d,drawVerticalLine:function(e,t,r){for(var a=t;a<=r;a++)d(e,a)},clear:function(){i.fillStyle="#EEEEEE",i.fillRect(0,0,a.a.screenWidth,a.a.screenHeight),i.fillStyle="#000000"},flip:function(){},drawDebugGrid:function(e){c.fillStyle="#FFFFFF",c.clearRect(0,0,u,y),c.strokeStyle="#000000";for(var t=0;t<e.length;t++)for(var r=0;r<e[0].length;r++){var l=e[t][r];c.strokeStyle="#333333",c.fillStyle=1===l?"#000000":3===l?"#00FF00":"#FFFFFF",c.fillRect(r*o,t*o,o,o),c.strokeRect(r*o,t*o,o,o)}c.fillStyle="#0000FF",c.fillRect(a.a.playerX*o-3,a.a.playerY*o-3,7,7),c.strokeStyle="#666666",c.beginPath(),c.moveTo(a.a.playerX*o,a.a.playerY*o),c.lineTo(a.a.playerX*o+1e3*Object(n.b)(Object(n.a)(a.a.playerAngle-a.a.viewAngleWidth/2)),a.a.playerY*o+1e3*Object(n.f)(Object(n.a)(a.a.playerAngle-a.a.viewAngleWidth/2))),c.stroke(),c.beginPath(),c.moveTo(a.a.playerX*o,a.a.playerY*o),c.lineTo(a.a.playerX*o+1e3*Object(n.b)(Object(n.a)(a.a.playerAngle+a.a.viewAngleWidth/2)),a.a.playerY*o+1e3*Object(n.f)(Object(n.a)(a.a.playerAngle+a.a.viewAngleWidth/2))),c.stroke()},drawDebugLine:function(e,t,r,a,n){void 0===n&&(n="rgba(200, 200, 200, 0.5)");c.strokeStyle=n,c.beginPath(),c.moveTo(e*o,t*o),c.lineTo(r*o,a*o),c.stroke()},drawDebugPixel:function(e,t,r){void 0===r&&(r="#ff8e00");c.fillStyle=r,c.fillRect(e*o-1,t*o-1,3,3)}};window.onload=function(){var e=document.getElementById("canvas");e?(e.width=a.a.screenWidth,e.height=a.a.screenHeight,(t=e.getContext("2d"))?i=t:console.error("Failed to get the 2d canvas context")):console.error("Failed to find canvas element");var t,r=document.getElementById("canvas-debug");r?(r.width=u,r.height=y,(t=r.getContext("2d"))?c=t:console.error("Failed to get the 2d canvas context for debug")):console.error("Failed to find canvas element for debug"),a.a.startGame(f),console.log("starting maze runner")};var u=a.a.mazeHorCells*o,y=a.a.mazeVerCells*o;function d(e,t){e>=0&&e<a.a.screenWidth&&t>=0&&t<a.a.screenHeight&&(i.fillStyle="#000000",i.fillRect(e,t,1,1))}}]);
//# sourceMappingURL=desktop.js.map