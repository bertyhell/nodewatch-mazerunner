!function(t){var a={};function n(e){if(a[e])return a[e].exports;var r=a[e]={i:e,l:!1,exports:{}};return t[e].call(r.exports,r,r.exports,n),r.l=!0,r.exports}n.m=t,n.c=a,n.d=function(e,r,t){n.o(e,r)||Object.defineProperty(e,r,{enumerable:!0,get:t})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(r,e){if(1&e&&(r=n(r)),8&e)return r;if(4&e&&"object"==typeof r&&r&&r.__esModule)return r;var t=Object.create(null);if(n.r(t),Object.defineProperty(t,"default",{enumerable:!0,value:r}),2&e&&"string"!=typeof r)for(var a in r)n.d(t,a,function(e){return r[e]}.bind(null,a));return t},n.n=function(e){var r=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(r,"a",r),r},n.o=function(e,r){return Object.prototype.hasOwnProperty.call(e,r)},n.p="",n(n.s=2)}([function(e,r,t){"use strict";function a(e){return(e+360)%360}function n(e){for(var r={},t=0;t<=360;t+=1)r[Math.round(t)]=e(t/180*Math.PI);return r}t.d(r,"a",function(){return a}),t.d(r,"b",function(){return u}),t.d(r,"c",function(){return f}),t.d(r,"d",function(){return y});var l=n(Math.cos),o=n(Math.sin),i=n(Math.tan);function c(e,r){var t=Math.floor(e),a=Math.ceil(e+1e-5),n=r[t],l=a-t,o=r[a]-n;return n+Math.abs(e-t)/l*o}function u(e){return c(e,l)}function f(e){return c(e,o)}function y(e){return c(e,i)}},function(e,r,t){"use strict";t.d(r,"a",function(){return S});var j=t(0),O=function(e,r){for(var t=[],a=0;a<r;a++){t[a]=[];for(var n=0;n<e;n++)a%2==0||n%2==0?t[a].push(1):t[a].push(-1)}var l,o=[],i={x:1,y:1};t[i.y][i.x]=0,o.push(i);for(;o.length;)if(i=o.pop(),(l=d(t,i)).length){o.push(i);var c=l[(u=0,f=l.length-1,Math.floor(Math.random()*(f-u+1)+u))];t[(c.y+i.y)/2][(c.x+i.x)/2]=0,t[c.y][c.x]=0,o.push(c)}var u,f;return t[1][1]=2,t[r-2][e-2]=3,t}(41,31),S={mazeWidth:20,mazeHeight:15,screenWidth:240,screenHeight:160,viewAngleWidth:70,angleStep:7,playerStepSize:.1,mazeHorCells:41,mazeVerCells:31,playerX:1.5,playerY:1.5,maze:O,playerAngle:1===O[1][2]?90:0,onFrame:function e(r){r.BTN4.read()&&(S.playerAngle=Object(j.a)(S.playerAngle-S.angleStep));r.BTN5.read()&&(S.playerAngle=Object(j.a)(S.playerAngle+S.angleStep));if(r.BTN1.read()){var t=Math.floor(S.playerAngle/90),a=2===t||3===t,n=3===t||0===t,l=Math.abs(Object(j.b)(S.playerAngle)*S.playerStepSize)*(n?1:-1),o=Math.abs(Object(j.c)(S.playerAngle)*S.playerStepSize)*(a?-1:1);u(l,o)}if(r.BTN2.read()){var t=Math.floor(S.playerAngle/90),a=2===t||3===t,n=3===t||0===t,l=Math.abs(Object(j.b)(S.playerAngle)*S.playerStepSize)*(n?-1:1),o=Math.abs(Object(j.c)(S.playerAngle)*S.playerStepSize)*(a?1:-1);u(l,o)}if(!i)return;p===S.playerX&&h===S.playerY&&s===S.playerAngle||(r.clear(),c(r),r.flip());p=S.playerX;h=S.playerY;s=S.playerAngle;setTimeout(function(){return e(r)},50)},startGame:function(e){i=!0,S.onFrame(e)},stopGame:function(){i=!1}},f={"0000":!1,"0001":!0,"0010":!0,"0011":!1,"0100":!0,"0101":!1,"0110":!1,"0111":!0,1e3:!0,1001:!0,1010:!1,1011:!0,1100:!1,1101:!0,1110:!0,1111:!1},i=!0;function F(e,r,t,a){return(t-e)*(t-e)+(a-r)*(a-r)}function A(e,r){return!(0<=r.x&&r.x<e[0].length&&0<=r.y&&r.y<e.length)}function y(e,r,t){for(var a,n,l,o,i,c,u,f,y,d,p,h,s,g,v,b,x,M,m=Math.floor(e/90),w=0;!a||!n;)p=2===m||3===m,a||(l||(o=p?Math.floor(S.playerY):Math.floor(S.playerY)+1,l=S.playerX-(S.playerY-o)/Object(j.d)(e)),0===w||u||(f=p?-1:1,u=1/Object(j.d)(e)),s=l+(u||0)*w*(p?-1:1),g=o+(f||0)*w,v={x:Math.floor(s),y:Math.floor(g)+(p?-1:0)},A(O,v)||1===O[v.y][v.x]?(r&&t.drawDebugPixel(s,g),a={x:s,y:g}):r&&t.drawDebugPixel(s,g,"#FF0000")),h=0===m||3===m,n||(i||(i=h?Math.floor(S.playerX)+1:Math.floor(S.playerX),c=S.playerY-(S.playerX-i)*Object(j.d)(e)),0===w||y||(y=h?1:-1,d=Math.abs(Object(j.d)(e))*(p?-1:1)),b=i+(y||0)*w,x=c+(d||0)*w,M={x:Math.floor(b)+(h?0:-1),y:Math.floor(x)},A(O,M)||1===O[M.y][M.x]?(r&&t.drawDebugPixel(b,x),n={x:b,y:x}):r&&t.drawDebugPixel(b,x,"#FF0000")),w++;var T=F(S.playerX,S.playerY,a.x,a.y)<F(S.playerX,S.playerY,n.x,n.y)?a:n;if(r&&t.drawDebugPixel(T.x,T.y,"#00FF00"),t.drawDebugLine(S.playerX,S.playerY,T.x,T.y),!T)throw new Error("intersection is null");return T}function c(a){a.drawDebugGrid(O);for(var e=Object(j.a)(S.playerAngle-S.viewAngleWidth/2),r=S.viewAngleWidth/S.screenWidth,t=[],n=0;n<S.screenWidth;n+=1){var l=Object(j.a)(e+r*n),o=y(l,0===n||n>=S.screenWidth-1,a),i=Math.sqrt(F(S.playerX,S.playerY,o.x,o.y))*Object(j.b)(Object(j.a)(l-S.playerAngle));t.push({angle:l,collision:o,distance:i,shouldDrawWall:!1})}var c={};t.forEach(function(e){var r=Math.round(e.collision.x),t=Math.round(e.collision.y);c[r+";"+t]={x:r,y:t}});var u=[];Object.keys(c).forEach(function(e){var r=c[e],t=O[r.y-1][r.x-1],a=O[r.y-1][r.x],n=O[r.y][r.x-1],l=O[r.y][r.x];f[(1===t?"1":"0")+(1===a?"1":"0")+(1===n?"1":"0")+(1===l?"1":"0")]&&u.push(r)}),u.forEach(function(a){var n=1e5,l=0;t.forEach(function(e,r){var t=Math.abs(a.x-e.collision.x)+Math.abs(a.y-e.collision.y);t<n&&(l=r,n=t)}),t[l].shouldDrawWall=!0}),t.forEach(function(e,r){var t=S.screenHeight/e.distance;e.shouldDrawWall?a.drawVerticalLine(r,Math.round((S.screenHeight-t)/2),Math.round((S.screenHeight-t)/2+t)):(a.drawPixel(r,Math.round((S.screenHeight-t)/2)),a.drawPixel(r,Math.round((S.screenHeight-t)/2+t)))})}function n(e,r){return 1===O[Math.floor(r)][Math.floor(e)]}function u(e,r){var t=S.playerX+e,a=S.playerY+r;return n(t,a)&&n(t=S.playerX,a=S.playerY+r)&&n(t=S.playerX+e,a=S.playerY)?void 0:(S.playerX=t,void(S.playerY=a))}function d(r,e){return[{x:e.x-2,y:e.y},{x:e.x,y:e.y-2},{x:e.x+2,y:e.y},{x:e.x,y:e.y+2}].filter(function(e){return!A(r,e)&&-1===r[e.y][e.x]})}console.log("screen: ",S.screenWidth,S.screenHeight);var p=void 0,h=void 0,s=void 0},function(e,r,t){"use strict";t.r(r);var n=t(1),l=t(0),a={BTN1:{name:"up",code:38,bangleVar:"BTN1",active:!1},BTN2:{name:"down",code:40,bangleVar:"BTN2",active:!1},BTN3:{name:"menu",code:9,bangleVar:"BTN3",active:!1},BTN4:{name:"left",code:37,bangleVar:"BTN4",active:!1},BTN5:{name:"right",code:39,bangleVar:"BTN5",active:!1}};[{prop:"keyup",active:!1},{prop:"keydown",active:!0}].forEach(function(t){document.addEventListener(t.prop,function(r){Object.keys(a).forEach(function(e){(r.which||r.keyCode)===a[e].code&&(a[e].active=t.active)})})});var o,i,c={BTN1:{read:function(){return a.BTN1.active}},BTN2:{read:function(){return a.BTN2.active}},BTN3:{read:function(){return a.BTN3.active}},BTN4:{read:function(){return a.BTN4.active}},BTN5:{read:function(){return a.BTN5.active}},drawPixel:y,drawVerticalLine:function(e,r,t){for(var a=r;a<=t;a++)y(e,a)},clear:function(){o.fillStyle="#EEEEEE",o.fillRect(0,0,n.a.screenWidth,n.a.screenHeight),o.fillStyle="#000000"},flip:function(){},drawDebugGrid:function(e){i.fillStyle="#FFFFFF",i.clearRect(0,0,u,f),i.strokeStyle="#000000";for(var r=0;r<e.length;r++)for(var t=0;t<e[0].length;t++){var a=e[r][t];i.strokeStyle="#333333",i.fillStyle=1===a?"#000000":3===a?"#00FF00":"#FFFFFF",i.fillRect(20*t,20*r,20,20),i.strokeRect(20*t,20*r,20,20)}i.fillStyle="#0000FF",i.fillRect(20*n.a.playerX-3,20*n.a.playerY-3,7,7),i.strokeStyle="#666666",i.beginPath(),i.moveTo(20*n.a.playerX,20*n.a.playerY),i.lineTo(20*n.a.playerX+1e3*Object(l.b)(Object(l.a)(n.a.playerAngle-n.a.viewAngleWidth/2)),20*n.a.playerY+1e3*Object(l.c)(Object(l.a)(n.a.playerAngle-n.a.viewAngleWidth/2))),i.stroke(),i.beginPath(),i.moveTo(20*n.a.playerX,20*n.a.playerY),i.lineTo(20*n.a.playerX+1e3*Object(l.b)(Object(l.a)(n.a.playerAngle+n.a.viewAngleWidth/2)),20*n.a.playerY+1e3*Object(l.c)(Object(l.a)(n.a.playerAngle+n.a.viewAngleWidth/2))),i.stroke()},drawDebugLine:function(e,r,t,a,n){void 0===n&&(n="rgba(200, 200, 200, 0.5)");i.strokeStyle=n,i.beginPath(),i.moveTo(20*e,20*r),i.lineTo(20*t,20*a),i.stroke()},drawDebugPixel:function(e,r,t){void 0===t&&(t="#ff8e00");i.fillStyle=t,i.fillRect(20*e-1,20*r-1,3,3)}};window.onload=function(){var e=document.getElementById("canvas");e?(e.width=n.a.screenWidth,e.height=n.a.screenHeight,(r=e.getContext("2d"))?o=r:console.error("Failed to get the 2d canvas context")):console.error("Failed to find canvas element");var r,t=document.getElementById("canvas-debug");t?(t.width=u,t.height=f,(r=t.getContext("2d"))?i=r:console.error("Failed to get the 2d canvas context for debug")):console.error("Failed to find canvas element for debug");n.a.startGame(c),console.log("starting maze runner")};var u=20*n.a.mazeHorCells,f=20*n.a.mazeVerCells;function y(e,r){0<=e&&e<n.a.screenWidth&&0<=r&&r<n.a.screenHeight&&(o.fillStyle="#000000",o.fillRect(e,r,1,1))}}]);