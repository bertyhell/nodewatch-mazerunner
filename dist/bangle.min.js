var n=(new Date).getTime();function r(r){var a=Math.floor((new Date).getTime()-n);console.log((r||"free memory")+"; "+a+"; "+process.memory().t)}function c(r){return(r+360)%360}function h(r){return Math.cos(r/180*Math.PI)}function f(r){return Math.sin(r/180*Math.PI)}function b(r){return Math.tan(r/180*Math.PI)}function D(r,a,n,t){return(n-r)*(n-r)+(t-a)*(t-a)}function A(r,a){return!(a.x>=0&&a.x<r[0].length&&a.y>=0&&a.y<r.length)}function u(a,r){var n=[{x:r.x-2,y:r.y},{x:r.x,y:r.y-2},{x:r.x+2,y:r.y},{x:r.x,y:r.y+2}];return n.filter(function(r){return!A(a,r)&&a[r.y][r.x]===-1})}function l(r,a){return Math.floor(Math.random()*(a-r+1)+r)}function a(r,a){var n=new Array(a);for(var t=0;t<a;t++){n[t]=new Array(r);for(var e=0;e<r;e++){if(t%2===0||e%2===0){n[t][e]=1}else{n[t][e]=-1}}}var i=[];var f={x:1,y:1};n[f.y][f.x]=0;i.push(f);var o;while(i.length){f=i.pop();o=u(n,f);if(o.length){i.push(f);var v=o[l(0,o.length-1)];n[(v.y+f.y)/2][(v.x+f.x)/2]=0;n[v.y][v.x]=0;i.push(v)}}n[1][1]=2;n[a-2][r-2]=3;return n}var t=3;var e=3;var i=240;var o=160;var v=1.5;var s=1.5;var M=70;var y=7;var w=.1;var m=t*2+1;var x=e*2+1;r("before maze");var F=a(m,x);r("after maze");var d=F[1][2]===1?90:0;var G={i:t,o:e,v:i,u:o,h:M,l:y,s:w,M:m,g:x,m:v,T:s,B:F,p:d,N:function(r){},D:function(){}};var T=true;function B(r){T=true;L(r)}function p(){T=false}function N(r,a,n){var t=Math.floor(r/90);var e;var i;var f=0;var o;var v;var u;var c;var h;var l;var s;var M;var y;var g;var w;var m;var x;var d;var T;var B;while(!e||!i){y=t===2||t===3;if(!e){if(!o){if(y){v=Math.floor(G.T)}else{v=Math.floor(G.T)+1}o=G.m-(G.T-v)/b(r)}if(f!==0&&!h){if(y){l=-1}else{l=1}h=1/b(r)}w=o+(h||0)*f*(y?-1:1);m=v+(l||0)*f;x={x:Math.floor(w),y:Math.floor(m)+(y?-1:0)};if(A(F,x)||F[x.y][x.x]===1){if(a){n.A(w,m)}e={x:w,y:m}}else{if(a){n.A(w,m,"#FF0000")}}}g=t===0||t===3;if(!i){if(!u){if(g){u=Math.floor(G.m)+1}else{u=Math.floor(G.m)}c=G.T-(G.m-u)*b(r)}if(f!==0&&!s){s=g?1:-1;M=Math.abs(b(r))*(y?-1:1)}d=u+(s||0)*f;T=c+(M||0)*f;B={x:Math.floor(d)+(g?0:-1),y:Math.floor(T)};if(A(F,B)||F[B.y][B.x]===1){if(a){n.A(d,T)}i={x:d,y:T}}else{if(a){n.A(d,T,"#FF0000")}}}f++}var p=D(G.m,G.T,e.x,e.y);var N=D(G.m,G.T,i.x,i.y);var z=p<N?e:i;if(a){n.A(z.x,z.y,"#00FF00")}n.F(G.m,G.T,z.x,z.y);if(!z){throw new Error("intersection is null")}return z}function z(r){r.G(F);var a=c(G.p-G.h/2);var n=G.h/G.v;var t=[];for(var e=0;e<G.v;e+=1){var i=c(a+n*e);var f=N(i,e===0||e>=G.v-1,r);var o=Math.sqrt(D(G.m,G.T,f.x,f.y));var v=o*h(c(i-G.p));var u=G.u/v;r.H(e,Math.round((G.u-u)/2));r.H(e,Math.round((G.u-u)/2+u))}}function H(r,a){return F[Math.floor(a)][Math.floor(r)]===1}function P(r,a){var n=G.m+r;var t=G.T+a;if(!H(n,t)){G.m=n;G.T=t;return}n=G.m;t=G.T+a;if(!H(n,t)){G.m=n;G.T=t;return}n=G.m+r;t=G.T;if(!H(n,t)){G.m=n;G.T=t;return}}var S;var W;var C;function L(r){if(r.P.read()){console.log("left");G.p=c(G.p-G.l)}if(r.S.read()){console.log("right");G.p=c(G.p+G.l)}var a;var n;var t;var e;var i;if(r.W.read()){console.log("forward");a=Math.floor(G.p/90);n=a===2||a===3;t=a===3||a===0;e=Math.abs(h(G.p)*G.s)*(t?1:-1);i=Math.abs(f(G.p)*G.s)*(n?-1:1);P(e,i)}if(r.C.read()){console.log("backward");a=Math.floor(G.p/90);n=a===2||a===3;t=a===3||a===0;e=Math.abs(h(G.p)*G.s)*(t?-1:1);i=Math.abs(f(G.p)*G.s)*(n?1:-1);P(e,i)}if(!T){return}if(S!==G.m||W!==G.T||C!==G.p){r.clear();z(r);r.flip()}S=G.m;W=G.T;C=G.p;setTimeout(function(){return L(r)},50)}G.N=B;G.D=p;var V=G;r("after engine loaded");var n=(new Date).getTime();function r(r){var a=Math.floor((new Date).getTime()-n);console.log((r||"free memory")+"; "+a+"; "+process.memory().t)}function c(r){return(r+360)%360}function h(r){return Math.cos(r/180*Math.PI)}function f(r){return Math.sin(r/180*Math.PI)}function b(r){return Math.tan(r/180*Math.PI)}function D(r,a,n,t){return(n-r)*(n-r)+(t-a)*(t-a)}function A(r,a){return!(a.x>=0&&a.x<r[0].length&&a.y>=0&&a.y<r.length)}function u(a,r){var n=[{x:r.x-2,y:r.y},{x:r.x,y:r.y-2},{x:r.x+2,y:r.y},{x:r.x,y:r.y+2}];return n.filter(function(r){return!A(a,r)&&a[r.y][r.x]===-1})}function l(r,a){return Math.floor(Math.random()*(a-r+1)+r)}function a(r,a){var n=new Array(a);for(var t=0;t<a;t++){n[t]=new Array(r);for(var e=0;e<r;e++){if(t%2===0||e%2===0){n[t][e]=1}else{n[t][e]=-1}}}var i=[];var f={x:1,y:1};n[f.y][f.x]=0;i.push(f);var o;while(i.length){f=i.pop();o=u(n,f);if(o.length){i.push(f);var v=o[l(0,o.length-1)];n[(v.y+f.y)/2][(v.x+f.x)/2]=0;n[v.y][v.x]=0;i.push(v)}}n[1][1]=2;n[a-2][r-2]=3;return n}Bangle.setLCDMode("doublebuffered");function k(r,a,n){g.setPixel(r,a)}function E(r,a,n){g.drawLine(r,a,r,n)}function clear(){g.clear()}function flip(){g.flip()}var X={W:BTN1,C:BTN2,L:BTN3,P:BTN4,S:BTN5,H:k,V:E,clear:clear,flip:flip,G:function(){},F:function(){},A:function(){}};g.setFontAlign(0,-1);g.clear();g.drawString("Press button 2 to start game ==>",120,(g.getHeight()-6)/2);console.log("version: "+process.version);r();function Y(){if(BTN2.read()){console.log("starting game");V.N(X)}else{setTimeout(Y,16)}}console.log("starting maze runner");Y();