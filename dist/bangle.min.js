function h(r){return(r+360)%360}function c(r){return Math.cos(r/180*Math.PI)}function v(r){return Math.sin(r/180*Math.PI)}function z(r){return Math.tan(r/180*Math.PI)}function F(r,a,t,e){return(t-r)*(t-r)+(e-a)*(e-a)}function A(r,a){return!(a.x>=0&&a.x<r[0].length&&a.y>=0&&a.y<r.length)}function o(a,r){var t=[{x:r.x-2,y:r.y},{x:r.x,y:r.y-2},{x:r.x+2,y:r.y},{x:r.x,y:r.y+2}];return t.filter(function(r){return!A(a,r)&&a[r.y][r.x]===-1})}function l(r,a){return Math.floor(Math.random()*(a-r+1)+r)}function r(r,a){var t=new Array(a);for(var e=0;e<a;e++){t[e]=new Array(r);for(var n=0;n<r;n++){if(e%2===0||n%2===0){t[e][n]=1}else{t[e][n]=-1}}}var i=[];var v={x:1,y:1};t[v.y][v.x]=0;i.push(v);var f;while(i.length){v=i.pop();f=o(t,v);if(f.length){i.push(v);var u=f[l(0,f.length-1)];t[(u.y+v.y)/2][(u.x+v.x)/2]=0;t[u.y][u.x]=0;i.push(u)}}t[1][1]=2;t[a-2][r-2]=3;return t}var a=3;var t=3;var e=240;var n=160;var i=1.5;var f=1.5;var u=70;var s=7;var M=.1;var y=a*2+1;var d=t*2+1;var D=r(y,d);var w=D[1][2]===1?90:0;var W={t:a,i:t,v:e,u:n,o:u,l:s,h:M,s:y,M:d,g:i,T:f,m:D,B:w,N:function(r){},p:function(){}};var T={"0000":false,"0001":true,"0010":true,"0011":false,"0100":true,"0101":false,"0110":false,"0111":true,1e3:true,1001:true,1010:false,1011:true,1100:false,1101:true,1110:true,1111:false};var m=true;function x(r){m=true;C(r)}function B(){m=false}function N(r,a,t){var e=Math.floor(r/90);var n;var i;var v=0;var f;var u;var o;var l;var h;var c;var s;var M;var g;var y;var d;var w;var T;var m;var x;var B;while(!n||!i){g=e===2||e===3;if(!n){if(!f){if(g){u=Math.floor(W.T)}else{u=Math.floor(W.T)+1}f=W.g-(W.T-u)/z(r)}if(v!==0&&!h){if(g){c=-1}else{c=1}h=1/z(r)}d=f+(h||0)*v*(g?-1:1);w=u+(c||0)*v;T={x:Math.floor(d),y:Math.floor(w)+(g?-1:0)};if(A(D,T)||D[T.y][T.x]===1){if(a)t.F(d,w);n={x:d,y:w}}else{if(a)t.F(d,w,"#FF0000")}}y=e===0||e===3;if(!i){if(!o){if(y){o=Math.floor(W.g)+1}else{o=Math.floor(W.g)}l=W.T-(W.g-o)*z(r)}if(v!==0&&!s){s=y?1:-1;M=Math.abs(z(r))*(g?-1:1)}m=o+(s||0)*v;x=l+(M||0)*v;B={x:Math.floor(m)+(y?0:-1),y:Math.floor(x)};if(A(D,B)||D[B.y][B.x]===1){if(a)t.F(m,x);i={x:m,y:x}}else{if(a)t.F(m,x,"#FF0000")}}v++}var N=F(W.g,W.T,n.x,n.y);var p=F(W.g,W.T,i.x,i.y);var b=N<p?n:i;if(a)t.F(b.x,b.y,"#00FF00");t.A(W.g,W.T,b.x,b.y);if(!b){throw new Error("intersection is null")}return b}function p(e){e.D(D);var r=h(W.B-W.o/2);var a=W.o/W.v;var t=[];for(var n=0;n<W.v;n+=1){var i=h(r+a*n);var v=N(i,n===0||n>=W.v-1,e);var f=Math.sqrt(F(W.g,W.T,v.x,v.y));var u=f*c(h(i-W.B));t.push({angle:i,W:v,G:u,H:false})}var o={};t.forEach(function(r){var a=Math.round(r.W.x);var t=Math.round(r.W.y);o[a+";"+t]={x:a,y:t}});var l=[];Object.keys(o).forEach(function(r){var a=o[r];var t=D[a.y-1][a.x-1];var e=D[a.y-1][a.x];var n=D[a.y][a.x-1];var i=D[a.y][a.x];var v=(t===1?"1":"0")+(e===1?"1":"0")+(n===1?"1":"0")+(i===1?"1":"0");var f=T[v];if(f){l.push(a)}});l.forEach(function(e){var n=1e5;var i=0;t.forEach(function(r,a){var t=Math.abs(e.x-r.W.x)+Math.abs(e.y-r.W.y);if(t<n){i=a;n=t}});t[i].H=true});t.forEach(function(r,a){var t=W.u/r.G;if(r.H){e.P(a,Math.round((W.u-t)/2),Math.round((W.u-t)/2+t))}else{e.S(a,Math.round((W.u-t)/2));e.S(a,Math.round((W.u-t)/2+t))}})}function b(r,a){return D[Math.floor(a)][Math.floor(r)]===1}function G(r,a){var t=W.g+r;var e=W.T+a;if(!b(t,e)){W.g=t;W.T=e;return}t=W.g;e=W.T+a;if(!b(t,e)){W.g=t;W.T=e;return}t=W.g+r;e=W.T;if(!b(t,e)){W.g=t;W.T=e;return}}var H;var P;var S;function C(r){if(r.C.read()){W.B=h(W.B-W.l)}if(r.L.read()){W.B=h(W.B+W.l)}var a;var t;var e;var n;var i;if(r.V.read()){a=Math.floor(W.B/90);t=a===2||a===3;e=a===3||a===0;n=Math.abs(c(W.B)*W.h)*(e?1:-1);i=Math.abs(v(W.B)*W.h)*(t?-1:1);G(n,i)}if(r.j.read()){a=Math.floor(W.B/90);t=a===2||a===3;e=a===3||a===0;n=Math.abs(c(W.B)*W.h)*(e?-1:1);i=Math.abs(v(W.B)*W.h)*(t?1:-1);G(n,i)}if(!m){return}if(H!==W.g||P!==W.T||S!==W.B){r.clear();p(r);r.flip()}H=W.g;P=W.T;S=W.B;setTimeout(function(){return C(r)},50)}W.N=x;W.p=B;var L=W;Bangle.setLCDMode("doublebuffered");function V(r,a,t){g.setPixel(r,a)}function j(r,a,t){g.drawLine(r,a,r,t)}function clear(){g.clear()}function flip(){g.flip()}var E={V:BTN1,j:BTN2,O:BTN3,C:BTN4,L:BTN5,S:V,P:j,clear:clear,flip:flip,D:function(){},A:function(){},F:function(){}};g.setFontAlign(0,-1);g.clear();g.drawString("Press button 2 to start game ==>",120,(g.getHeight()-6)/2);function O(){if(BTN2.read()){console.log("starting game");L.N(E)}else{setTimeout(O,16)}}console.log("starting maze runner");O();