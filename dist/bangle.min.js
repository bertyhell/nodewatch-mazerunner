var r=(new Date).getTime();function c(r){return(r+360)%360}function h(r){return Math.cos(r/180*Math.PI)}function v(r){return Math.sin(r/180*Math.PI)}function z(r){return Math.tan(r/180*Math.PI)}function F(r,a,t,e){return(t-r)*(t-r)+(e-a)*(e-a)}function A(r,a){return!(a.x>=0&&a.x<r[0].length&&a.y>=0&&a.y<r.length)}function u(a,r){var t=[{x:r.x-2,y:r.y},{x:r.x,y:r.y-2},{x:r.x+2,y:r.y},{x:r.x,y:r.y+2}];return t.filter(function(r){return!A(a,r)&&a[r.y][r.x]===-1})}function l(r,a){return Math.floor(Math.random()*(a-r+1)+r)}function a(r,a){var t=new Array(a);for(var e=0;e<a;e++){t[e]=new Array(r);for(var n=0;n<r;n++){if(e%2===0||n%2===0){t[e][n]=1}else{t[e][n]=-1}}}var i=[];var v={x:1,y:1};t[v.y][v.x]=0;i.push(v);var f;while(i.length){v=i.pop();f=u(t,v);if(f.length){i.push(v);var o=f[l(0,f.length-1)];t[(o.y+v.y)/2][(o.x+v.x)/2]=0;t[o.y][o.x]=0;i.push(o)}}t[1][1]=2;t[a-2][r-2]=3;return t}var t=3;var e=3;var n=240;var i=160;var f=1.5;var o=1.5;var s=70;var M=7;var w=.1;var y=t*2+1;var d=e*2+1;var T=8;var D=a(y,d);var m=D[1][2]===1?90:0;var G={t:t,i:e,v:n,o:i,u:s,h:M,l:w,s:y,M:d,g:f,T:o,m:D,B:m,N:function(r){},p:function(){}};var B=true;function x(r){B=true;L(r)}function N(){B=false}function p(r,a,t){var e=Math.floor(r/90);var n;var i;var v=0;var f;var o;var u;var c;var h;var l;var s;var M;var g;var w;var y;var d;var T;var m;var B;var x;while(!n||!i){g=e===2||e===3;if(!n){if(!f){if(g){o=Math.floor(G.T)}else{o=Math.floor(G.T)+1}f=G.g-(G.T-o)/z(r)}if(v!==0&&!h){if(g){l=-1}else{l=1}h=1/z(r)}y=f+(h||0)*v*(g?-1:1);d=o+(l||0)*v;T={x:Math.floor(y),y:Math.floor(d)+(g?-1:0)};if(A(D,T)||D[T.y][T.x]===1){if(a){t.F(y,d)}n={x:y,y:d}}else{if(a){t.F(y,d,"#FF0000")}}}w=e===0||e===3;if(!i){if(!u){if(w){u=Math.floor(G.g)+1}else{u=Math.floor(G.g)}c=G.T-(G.g-u)*z(r)}if(v!==0&&!s){s=w?1:-1;M=Math.abs(z(r))*(g?-1:1)}m=u+(s||0)*v;B=c+(M||0)*v;x={x:Math.floor(m)+(w?0:-1),y:Math.floor(B)};if(A(D,x)||D[x.y][x.x]===1){if(a){t.F(m,B)}i={x:m,y:B}}else{if(a){t.F(m,B,"#FF0000")}}}v++}var N=F(G.g,G.T,n.x,n.y);var p=F(G.g,G.T,i.x,i.y);var b=N<p?n:i;if(a){t.F(b.x,b.y,"#00FF00")}t.A(G.g,G.T,b.x,b.y);if(!b){throw new Error("intersection is null")}return b}function b(r){r.D(D);var a=c(G.B-G.u/2);var t=G.u/G.v;var e=[];for(var n=0;n<G.v;n+=T){var i=c(a+t*n);var v=p(i,n===0||n>=G.v-1,r);var f=Math.sqrt(F(G.g,G.T,v.x,v.y));var o=f*h(c(i-G.B));var u=G.o/o;r.G(n,Math.round((G.o-u)/2));r.G(n,Math.round((G.o-u)/2+u))}}function H(r,a){return D[Math.floor(a)][Math.floor(r)]===1}function P(r,a){var t=G.g+r;var e=G.T+a;if(!H(t,e)){G.g=t;G.T=e;return}t=G.g;e=G.T+a;if(!H(t,e)){G.g=t;G.T=e;return}t=G.g+r;e=G.T;if(!H(t,e)){G.g=t;G.T=e;return}}var S;var W;var C;function L(r){if(r.H.read()){console.log("left");G.B=c(G.B-G.h)}if(r.P.read()){console.log("right");G.B=c(G.B+G.h)}var a;var t;var e;var n;var i;if(r.S.read()){console.log("forward");a=Math.floor(G.B/90);t=a===2||a===3;e=a===3||a===0;n=Math.abs(h(G.B)*G.l)*(e?1:-1);i=Math.abs(v(G.B)*G.l)*(t?-1:1);P(n,i)}if(r.W.read()){console.log("backward");a=Math.floor(G.B/90);t=a===2||a===3;e=a===3||a===0;n=Math.abs(h(G.B)*G.l)*(e?-1:1);i=Math.abs(v(G.B)*G.l)*(t?1:-1);P(n,i)}if(!B){return}if(S!==G.g||W!==G.T||C!==G.B){r.clear();b(r);r.flip()}S=G.g;W=G.T;C=G.B;setTimeout(function(){return L(r)},50)}G.N=x;G.p=N;var V=G;Bangle.setLCDMode("doublebuffered");function k(r,a,t){g.setPixel(r,a)}function E(r,a,t){g.drawLine(r,a,r,t)}function clear(){g.clear()}function flip(){g.flip()}var X={S:BTN1,W:BTN2,C:BTN3,H:BTN4,P:BTN5,G:k,L:E,clear:clear,flip:flip,D:function(){},A:function(){},F:function(){}};g.setFontAlign(0,-1);g.clear();g.drawString("Press button 2 to start game ==>",120,(g.getHeight()-6)/2);g.flip();console.log("version: "+process.version);function Y(){if(BTN2.read()){console.log("starting game");V.N(X)}else{setTimeout(Y,16)}}console.log("starting maze runner");Y();