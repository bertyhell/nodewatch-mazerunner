!function(e){var t={};function r(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)r.d(n,o,function(t){return e[t]}.bind(null,o));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=3)}([function(e,t,r){"use strict";r.d(t,"h",(function(){return i})),r.d(t,"a",(function(){return l})),r.d(t,"b",(function(){return c})),r.d(t,"f",(function(){return u})),r.d(t,"g",(function(){return f})),r.d(t,"d",(function(){return s})),r.d(t,"e",(function(){return h})),r.d(t,"c",(function(){return p}));var n,o={},a=!1;function i(e){if(!a){var t=(new Date).getTime();if(n){var r=t-n;o[e]?(o[e].avgTime=(o[e].avgTime*o[e].traces+r)/(o[e].traces+1),o[e].traces+=1):o[e]={avgTime:r,traces:1}}n=t,o[e]&&10===o[e].traces&&(Object.keys(o).forEach((function(e){console.log(e+";"+o[e].avgTime)})),a=!0)}}function l(e){return(e+360)%360}function c(e){return Math.cos(e/180*Math.PI)}function u(e){return Math.sin(e/180*Math.PI)}function f(e){return Math.tan(e/180*Math.PI)}function s(e,t,r,n){return(r-e)*(r-e)+(n-t)*(n-t)}function h(e,t){return!(t.x>=0&&t.x<e[0].length&&t.y>=0&&t.y<e.length)}function y(e,t){return[{x:t.x-2,y:t.y},{x:t.x,y:t.y-2},{x:t.x+2,y:t.y},{x:t.x,y:t.y+2}].filter((function(t){return!h(e,t)&&-1===e[t.y][t.x]}))}function p(e,t){for(var r=new Array(t),n=0;n<t;n++){r[n]=new Array(e);for(var o=0;o<e;o++)r[n][o]=n%2==0||o%2==0?1:-1}var a,i,l,c=[],u={x:1,y:1};for(r[u.y][u.x]=0,c.push(u);c.length;)if((a=y(r,u=c.pop())).length){c.push(u);var f=a[(i=0,l=a.length-1,Math.floor(Math.random()*(l-i+1)+i))];r[(f.y+u.y)/2][(f.x+u.x)/2]=0,r[f.y][f.x]=0,c.push(f)}return r[1][1]=2,r[t-2][e-2]=3,r}},function(e,t,r){"use strict";r.d(t,"a",(function(){return d}));var n,o,a,i=r(0),l=1,c=Object(i.c)(21,13),u=1===c[1][2]?90:0,f={mazeWidth:10,mazeHeight:6,screenWidth:240,screenHeight:160,viewAngleWidth:70,angleStep:7,playerStepSize:.1,mazeHorCells:21,mazeVerCells:13,playerX:1.5,playerY:1.5,maze:c,playerAngle:u,startGame:function(e){},stopGame:function(){}},s=!0;function h(e,t,r){var n,o,a,l,u,s,h,y,p,d,g,b,v,x,m,w,O,j,T=Math.floor(e/90),M=0;for(Object(i.h)("01 collision start hor");!n||!o;)g=2===T||3===T,n||(a||(l=g?Math.floor(f.playerY):Math.floor(f.playerY)+1,a=f.playerX-(f.playerY-l)/Object(i.g)(e)),Object(i.h)("02 after hor intersect"),0===M||h||(y=g?-1:1,h=1/Object(i.g)(e)),Object(i.h)("03 after hor offset"),v=a+(h||0)*M*(g?-1:1),x=l+(y||0)*M,m={x:Math.floor(v),y:Math.floor(x)+(g?-1:0)},Object(i.h)("04 after hor grid location"),Object(i.e)(c,m)||1===c[m.y][m.x]?(t&&r.drawDebugPixel(v,x),n={x:v,y:x}):t&&r.drawDebugPixel(v,x,"#FF0000"),Object(i.h)("05 after hor found location")),Object(i.h)("06 collision start vert"),b=0===T||3===T,o||(u||(u=b?Math.floor(f.playerX)+1:Math.floor(f.playerX),s=f.playerY-(f.playerX-u)*Object(i.g)(e)),Object(i.h)("07 after vert intersect"),0===M||p||(p=b?1:-1,d=Math.abs(Object(i.g)(e))*(g?-1:1)),Object(i.h)("08 after vert offset"),w=u+(p||0)*M,O=s+(d||0)*M,j={x:Math.floor(w)+(b?0:-1),y:Math.floor(O)},Object(i.h)("09 after vert grid location"),Object(i.e)(c,j)||1===c[j.y][j.x]?(t&&r.drawDebugPixel(w,O),o={x:w,y:O}):t&&r.drawDebugPixel(w,O,"#FF0000"),Object(i.h)("10 after vert found location")),M++;Object(i.h)("11 after intersection found location");var A=Object(i.d)(f.playerX,f.playerY,n.x,n.y)<Object(i.d)(f.playerX,f.playerY,o.x,o.y)?n:o;if(t&&r.drawDebugPixel(A.x,A.y,"#00FF00"),r.drawDebugLine(f.playerX,f.playerY,A.x,A.y),!A)throw new Error("intersection is null");return Object(i.h)("12 return intersection"),A}function y(e,t){return 1===c[Math.floor(t)][Math.floor(e)]}function p(e,t){var r=f.playerX+e,n=f.playerY+t;return y(r,n)&&y(r=f.playerX,n=f.playerY+t)&&y(r=f.playerX+e,n=f.playerY)?void 0:(f.playerX=r,void(f.playerY=n))}f.startGame=function(e){s=!0,function e(t){t.BTN4.read()&&(console.log("left"),f.playerAngle=Object(i.a)(f.playerAngle-f.angleStep));t.BTN5.read()&&(console.log("right"),f.playerAngle=Object(i.a)(f.playerAngle+f.angleStep));var r,u,y,d,g;t.BTN1.read()&&(console.log("forward"),r=Math.floor(f.playerAngle/90),u=2===r||3===r,y=3===r||0===r,d=Math.abs(Object(i.b)(f.playerAngle)*f.playerStepSize)*(y?1:-1),g=Math.abs(Object(i.f)(f.playerAngle)*f.playerStepSize)*(u?-1:1),p(d,g));t.BTN2.read()&&(console.log("backward"),r=Math.floor(f.playerAngle/90),u=2===r||3===r,y=3===r||0===r,d=Math.abs(Object(i.b)(f.playerAngle)*f.playerStepSize)*(y?-1:1),g=Math.abs(Object(i.f)(f.playerAngle)*f.playerStepSize)*(u?1:-1),p(d,g));if(!s)return;n===f.playerX&&o===f.playerY&&a===f.playerAngle||(t.clear(),function(e){e.drawDebugGrid(c);for(var t=Object(i.a)(f.playerAngle-f.viewAngleWidth/2),r=f.viewAngleWidth/f.screenWidth,n=[],o=0;o<f.screenWidth;o+=l){var a=Object(i.a)(t+r*o),u=h(a,0===o||o>=f.screenWidth-1,e),s=Math.sqrt(Object(i.d)(f.playerX,f.playerY,u.x,u.y))*Object(i.b)(Object(i.a)(a-f.playerAngle));n.push({angle:a,collision:u,distance:s,shouldDrawWall:!1})}var y={};n.forEach((function(e){var t=Math.round(e.collision.x),r=Math.round(e.collision.y);y[t+";"+r]={x:t,y:r}}));var p={"0000":!1,"0001":!0,"0010":!0,"0011":!1,"0100":!0,"0101":!1,"0110":!1,"0111":!0,1e3:!0,1001:!0,1010:!1,1011:!0,1100:!1,1101:!0,1110:!0,1111:!1},d=[];Object.keys(y).forEach((function(e){var t=y[e],r=c[t.y-1][t.x-1],n=c[t.y-1][t.x],o=c[t.y][t.x-1],a=c[t.y][t.x];p[(1===r?"1":"0")+(1===n?"1":"0")+(1===o?"1":"0")+(1===a?"1":"0")]&&d.push(t)})),p={},d.forEach((function(e){var t=1e5,r=0;n.forEach((function(n,o){var a=Math.abs(e.x-n.collision.x)+Math.abs(e.y-n.collision.y);a<t&&(r=o,t=a)})),n[r].shouldDrawWall=!0})),n.forEach((function(t,r){var n=f.screenHeight/t.distance;t.shouldDrawWall?e.drawVerticalLine(r,Math.round((f.screenHeight-n)/2),Math.round((f.screenHeight-n)/2+n)):(e.drawPixel(r,Math.round((f.screenHeight-n)/2)),e.drawPixel(r,Math.round((f.screenHeight-n)/2+n)))}))}(t),t.flip());n=f.playerX,o=f.playerY,a=f.playerAngle,setTimeout((function(){return e(t)}),50)}(e)},f.stopGame=function(){s=!1};var d=f},,function(e,t,r){"use strict";r.r(t),function(e){var t=r(1);Bangle.setLCDMode("doublebuffered");var n={BTN1:BTN1,BTN2:BTN2,BTN3:BTN3,BTN4:BTN4,BTN5:BTN5,drawPixel:function(e,t,r){g.setPixel(e,t)},drawVerticalLine:function(e,t,r){g.drawLine(e,t,e,r)},clear:function(){g.clear()},flip:function(){g.flip()},drawDebugGrid:function(){},drawDebugLine:function(){},drawDebugPixel:function(){}};g.setFontAlign(0,-1),g.clear(),g.drawString("Press button 2 to start game ==>",120,(g.getHeight()-6)/2),g.flip(),console.log("version: "+e.version),console.log("starting maze runner"),function e(){BTN2.read()?(console.log("starting game"),t.a.startGame(n)):setTimeout(e,16)}()}.call(this,r(4))},function(e,t){var r,n,o=e.exports={};function a(){throw new Error("setTimeout has not been defined")}function i(){throw new Error("clearTimeout has not been defined")}function l(e){if(r===setTimeout)return setTimeout(e,0);if((r===a||!r)&&setTimeout)return r=setTimeout,setTimeout(e,0);try{return r(e,0)}catch(t){try{return r.call(null,e,0)}catch(t){return r.call(this,e,0)}}}!function(){try{r="function"==typeof setTimeout?setTimeout:a}catch(e){r=a}try{n="function"==typeof clearTimeout?clearTimeout:i}catch(e){n=i}}();var c,u=[],f=!1,s=-1;function h(){f&&c&&(f=!1,c.length?u=c.concat(u):s=-1,u.length&&y())}function y(){if(!f){var e=l(h);f=!0;for(var t=u.length;t;){for(c=u,u=[];++s<t;)c&&c[s].run();s=-1,t=u.length}c=null,f=!1,function(e){if(n===clearTimeout)return clearTimeout(e);if((n===i||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(e);try{n(e)}catch(t){try{return n.call(null,e)}catch(t){return n.call(this,e)}}}(e)}}function p(e,t){this.fun=e,this.array=t}function d(){}o.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];u.push(new p(e,t)),1!==u.length||f||l(y)},p.prototype.run=function(){this.fun.apply(null,this.array)},o.title="browser",o.browser=!0,o.env={},o.argv=[],o.version="",o.versions={},o.on=d,o.addListener=d,o.once=d,o.off=d,o.removeListener=d,o.removeAllListeners=d,o.emit=d,o.prependListener=d,o.prependOnceListener=d,o.listeners=function(e){return[]},o.binding=function(e){throw new Error("process.binding is not supported")},o.cwd=function(){return"/"},o.chdir=function(e){throw new Error("process.chdir is not supported")},o.umask=function(){return 0}}]);
//# sourceMappingURL=bangle.js.map