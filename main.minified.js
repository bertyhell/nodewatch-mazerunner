for(var f=1.5,g=1.5,h=[],k=0;31>k;k++){h[k]=[];for(var l=0;41>l;l++)0===k%2||0===l%2?h[k].push(1):h[k].push(-1)}var p=[],w={x:1,y:1};h[w.y][w.x]=0;p.push(w);for(var x;p.length;)if(w=p.pop(),x=A(),x.length){p.push(w);var B=x[Math.floor(Math.random()*(x.length-1+1))];h[(B.y+w.y)/2][(B.x+w.x)/2]=0;h[B.y][B.x]=0;p.push(B)}h[1][1]=2;h[29][39]=3;
var D=1===h[1][2]?90:0,aa={"0000":!1,"0001":!0,"0010":!0,"0011":!1,"0100":!0,"0101":!1,"0110":!1,"0111":!0,1E3:!0,1001:!0,1010:!1,1011:!0,1100:!1,1101:!0,1110:!0,1111:!1},E={g:{name:"up",code:38,a:"BTN1",active:!1},h:{name:"down",code:40,a:"BTN2",active:!1},o:{name:"menu",code:9,a:"BTN3",active:!1},i:{name:"left",code:37,a:"BTN4",active:!1},j:{name:"right",code:39,a:"BTN5",active:!1}};
[{c:"keyup",active:!1},{c:"keydown",active:!0}].forEach(function(a){document.addEventListener(a.c,function(c){Object.keys(E).forEach(function(b){(c.which||c.keyCode)===E[b].code&&(E[b].active=a.active)})})});var F={},ba={read:function(){return E.g.active}},ca={read:function(){return E.h.active}},da={read:function(){return E.i.active}},ea={read:function(){return E.j.active}},G,J;
window.onload=function(){var a=document.getElementById("canvas");a?(a.width=240,a.height=160,(a=a.getContext("2d"))?(G=a,F={m:function(c,b){G.fillStyle="#000000";G.fillRect(c,b,1,1)},clear:function(){G.fillStyle="#EEEEEE";G.fillRect(0,0,240,160);G.fillStyle="#000000"},s:function(){},v:function(){return 240},u:function(){return 160}}):console.error("Failed to get the 2d canvas context")):console.error("Failed to find canvas element");(a=document.getElementById("canvas-debug"))?(a.width=820,a.height=
	620,(a=a.getContext("2d"))?J=a:console.error("Failed to get the 2d canvas context for debug")):console.error("Failed to find canvas element for debug");setTimeout(K,500);console.log("starting maze runner")};function L(a){for(var c={},b=0;360>=b;b+=1)c[Math.round(b)]=a(b/180*Math.PI);return c}var N=L(Math.cos),O=L(Math.sin),P=L(Math.tan);function Q(a,c){var b=Math.floor(a),d=Math.ceil(a+1E-5),m=c[b];return m+Math.abs(a-b)/(d-b)*(c[d]-m)}console.log("screen: ",240,160);
function fa(){J.fillStyle="#FFFFFF";J.clearRect(0,0,820,620);J.strokeStyle="#000000";for(var a=0;a<h.length;a++)for(var c=0;c<h[0].length;c++){var b=h[a][c];J.strokeStyle="#333333";J.fillStyle=1===b?"#000000":3===b?"#00FF00":"#FFFFFF";J.fillRect(20*c,20*a,20,20);J.strokeRect(20*c,20*a,20,20)}J.fillStyle="#0000FF";J.fillRect(20*f-3,20*g-3,7,7);J.strokeStyle="#666666";J.beginPath();J.moveTo(20*f,20*g);J.lineTo(20*f+1E3*Q((D-35+360)%360,N),20*g+1E3*Q((D-35+360)%360,O));J.stroke();J.beginPath();J.moveTo(20*
	f,20*g);J.lineTo(20*f+1E3*Q((D+35+360)%360,N),20*g+1E3*Q((D+35+360)%360,O));J.stroke()}function R(a,c,b){void 0===b&&(b="#ff8e00");J.fillStyle=b;J.fillRect(20*a-1,20*c-1,3,3)}function ha(a,c){var b=f,d=g,m;void 0===m&&(m="rgba(200, 200, 200, 0.5)");J.strokeStyle=m;J.beginPath();J.moveTo(20*b,20*d);J.lineTo(20*a,20*c);J.stroke()}function S(a,c){var b=f,d=g;return(a-b)*(a-b)+(c-d)*(c-d)}function T(a){return!(0<=a.x&&a.x<h[0].length&&0<=a.y&&a.y<h.length)}
function ia(a,c){for(var b=Math.floor(a/90),d,m,t=0,y,C,e,r,n,z,H,I,u,q,v,M;!d||!m;)u=2===b||3===b,d||(y||(C=u?Math.floor(g):Math.floor(g)+1,y=f-(g-C)/Q(a,P)),0===t||n||(z=u?-1:1,n=1/Q(a,P)),q=y+(n||0)*t*(u?-1:1),v=C+(z||0)*t,M={x:Math.floor(q),y:Math.floor(v)+(u?-1:0)},T(M)||1===h[M.y][M.x]?(c?R(q,v):function(){},d={x:q,y:v}):c?R(q,v,"#FF0000"):function(){}),q=0===b||3===b,m||(e||(e=q?Math.floor(f)+1:Math.floor(f),r=g-(f-e)*Q(a,P)),0===t||H||(H=q?1:-1,I=Math.abs(Q(a,P))*(u?-1:1)),u=e+(H||0)*t,v=
	r+(I||0)*t,q={x:Math.floor(u)+(q?0:-1),y:Math.floor(v)},T(q)||1===h[q.y][q.x]?(c?R(u,v):function(){},m={x:u,y:v}):c?R(u,v,"#FF0000"):function(){}),t++;b=S(d.x,d.y)<S(m.x,m.y)?d:m;c?R(b.x,b.y,"#00FF00"):function(){};ha(b.x,b.y);if(!b)throw Error("intersection is null");return b}function U(a,c){0<=a&&240>a&&0<=c&&160>c&&F.m(a,c)}
function ja(){fa();for(var a=(D-35+360)%360,c=70/240,b=[],d=0;240>d;d+=1){var m=(a+c*d+360)%360,t=ia(m,0===d||239<=d);b.push({angle:m,b:t,l:Math.sqrt(S(t.x,t.y))*Q((m-D+360)%360,N),f:!1})}var y={};b.forEach(function(e){var r=Math.round(e.b.x);e=Math.round(e.b.y);y[r+";"+e]={x:r,y:e}});var C=[];Object.keys(y).forEach(function(e){e=y[e];aa[(1===h[e.y-1][e.x-1]?"1":"0")+(1===h[e.y-1][e.x]?"1":"0")+(1===h[e.y][e.x-1]?"1":"0")+(1===h[e.y][e.x]?"1":"0")]&&C.push(e)});C.forEach(function(e){var r=1E5,n=0;
	b.forEach(function(z,H){var I=Math.abs(e.x-z.b.x)+Math.abs(e.y-z.b.y);I<r&&(n=H,r=I)});b[n].f=!0});b.forEach(function(e,r){var n=160/e.l;if(e.f){var z=Math.round((160-n)/2+n);for(n=Math.round((160-n)/2);n<=z;n++)U(r,n)}else U(r,Math.round((160-n)/2)),U(r,Math.round((160-n)/2+n))})}function V(a,c){return 1===h[Math.floor(c)][Math.floor(a)]}function W(a,c){var b=f+a,d=g+c;V(b,d)?(b=f,d=g+c,V(b,d)?(b=f+a,d=g,V(b,d)||(f=b,g=d)):(f=b,g=d)):(f=b,g=d)}
function A(){var a=w;return[{x:a.x-2,y:a.y},{x:a.x,y:a.y-2},{x:a.x+2,y:a.y},{x:a.x,y:a.y+2}].filter(function(c){return!T(c)&&-1===h[c.y][c.x]})}var X=void 0,Y=void 0,Z=void 0;
function K(){da.read()&&(D=(D-7+360)%360);ea.read()&&(D=(D+7+360)%360);if(ba.read()){var a=Math.floor(D/90),c=Math.abs(.1*Q(D,N))*(3===a||0===a?1:-1);a=Math.abs(.1*Q(D,O))*(2===a||3===a?-1:1);W(c,a)}ca.read()&&(a=Math.floor(D/90),c=Math.abs(.1*Q(D,N))*(3===a||0===a?-1:1),a=Math.abs(.1*Q(D,O))*(2===a||3===a?1:-1),W(c,a));if(X!==f||Y!==g||Z!==D)F.clear(),ja();X=f;Y=g;Z=D;setTimeout(K,50)};
